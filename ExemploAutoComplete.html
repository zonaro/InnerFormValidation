<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoComplete de Geolocalização - InnerFormValidation</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">

    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container {
            padding: 2rem 0;
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .card-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            border: none;
            text-align: center;
        }

        .form-control {
            border-radius: 10px;
            border: 2px solid #e3f2fd;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: #4facfe;
            box-shadow: 0 0 0 0.2rem rgba(79, 172, 254, 0.25);
        }

        .btn {
            border-radius: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            border: none;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(86, 171, 47, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(240, 147, 251, 0.4);
        }

        .alert {
            border-radius: 10px;
            border: none;
        }

        .form-group label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 0.8rem;
        }

        .code-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3 class="mb-0"><i class="fas fa-map-marker-alt"></i> AutoComplete de Geolocalização</h3>
                        <p class="mb-0">Demonstração do preenchimento automático de campos de latitude e longitude</p>
                    </div>
                    <div class="card-body">

                        <!-- Informações sobre o AutoComplete -->
                        <div class="alert alert-info">
                            <h5><i class="fas fa-info-circle"></i> Como Funciona</h5>
                            <p class="mb-2">Quando uma localização é obtida, os campos com as classes abaixo são
                                automaticamente preenchidos:</p>
                            <ul class="mb-0">
                                <li><code>.autocomplete.latitude</code> ou <code>.autocomplete.lat</code> - Para
                                    latitude</li>
                                <li><code>.autocomplete.longitude</code> ou <code>.autocomplete.long</code> - Para
                                    longitude</li>
                            </ul>
                        </div>

                        <!-- Formulário com campos de AutoComplete -->
                        <form class="validate">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-map-pin"></i> Latitude</label>
                                        <input type="text" class="form-control autocomplete latitude"
                                            placeholder="Latitude (preenchida automaticamente)" readonly>
                                        <small class="text-muted">Classe: <code>.autocomplete.latitude</code></small>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-map-pin"></i> Longitude</label>
                                        <input type="text" class="form-control autocomplete longitude"
                                            placeholder="Longitude (preenchida automaticamente)" readonly>
                                        <small class="text-muted">Classe: <code>.autocomplete.longitude</code></small>
                                    </div>
                                </div>
                            </div>

                            <!-- Campos alternativos com classes abreviadas -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-crosshairs"></i> Lat (Abreviado)</label>
                                        <input type="text" class="form-control autocomplete lat"
                                            placeholder="Latitude (classe abreviada)" readonly>
                                        <small class="text-muted">Classe: <code>.autocomplete.lat</code></small>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-crosshairs"></i> Long (Abreviado)</label>
                                        <input type="text" class="form-control autocomplete long"
                                            placeholder="Longitude (classe abreviada)" readonly>
                                        <small class="text-muted">Classe: <code>.autocomplete.long</code></small>
                                    </div>
                                </div>
                            </div>

                            <!-- Campos editáveis (sem readonly) -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-edit"></i> Latitude Editável</label>
                                        <input type="text" class="form-control autocomplete latitude noreplace"
                                            placeholder="Editável - só preenche se vazio">
                                        <small class="text-muted">Sem <code>readonly</code> e com
                                            <code>.noreplace</code></small>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-edit"></i> Longitude Editável</label>
                                        <input type="text" class="form-control autocomplete longitude noreplace"
                                            placeholder="Editável - só preenche se vazio">
                                        <small class="text-muted">Sem <code>readonly</code> e com
                                            <code>.noreplace</code></small>
                                    </div>
                                </div>
                            </div>

                            <!-- Campos com Máscaras e Validações -->
                            <div class="alert alert-warning">
                                <h5><i class="fas fa-tools"></i> Campos com Máscaras e Validações</h5>
                                <p class="mb-0">Os campos abaixo têm máscaras e validações aplicadas para garantir que
                                    apenas coordenadas válidas sejam aceitas.</p>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-check-circle"></i> Latitude com Validação</label>
                                        <input type="text"
                                            class="form-control autocomplete latitude mask latitude obg onkeyup"
                                            placeholder="-90.000000 a +90.000000">
                                        <small class="text-muted">Classe: <code>.mask.latitude.obg.onkeyup</code><br>
                                            Aceita valores entre -90 e +90 graus</small>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-check-circle"></i> Longitude com Validação</label>
                                        <input type="text"
                                            class="form-control autocomplete longitude mask longitude obg onkeyup"
                                            placeholder="-180.000000 a +180.000000">
                                        <small class="text-muted">Classe: <code>.mask.longitude.obg.onkeyup</code><br>
                                            Aceita valores entre -180 e +180 graus</small>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-compass"></i> Coordenada Lat com Precisão</label>
                                        <input type="text"
                                            class="form-control autocomplete lat mask lat precision 6 obg onkeyup"
                                            placeholder="Latitude com 6 casas decimais">
                                        <small class="text-muted">Classe: <code>.mask.lat.precision.6</code><br>
                                            Limita a 6 casas decimais de precisão</small>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-compass"></i> Coordenada Long com Precisão</label>
                                        <input type="text"
                                            class="form-control autocomplete long mask long precision 6 obg onkeyup"
                                            placeholder="Longitude com 6 casas decimais">
                                        <small class="text-muted">Classe: <code>.mask.long.precision.6</code><br>
                                            Limita a 6 casas decimais de precisão</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Elementos não-input também são preenchidos -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-eye"></i> Latitude (Span)</label>
                                        <div class="form-control autocomplete latitude bg-light"
                                            style="height: auto; padding: 0.75rem;">
                                            Aguardando localização...
                                        </div>
                                        <small class="text-muted">Elemento <code>&lt;div&gt;</code> com classe
                                            autocomplete</small>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-eye"></i> Longitude (Span)</label>
                                        <div class="form-control autocomplete longitude bg-light"
                                            style="height: auto; padding: 0.75rem;">
                                            Aguardando localização...
                                        </div>
                                        <small class="text-muted">Elemento <code>&lt;div&gt;</code> com classe
                                            autocomplete</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Botões de ação -->
                            <div class="row">
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-primary btn-block"
                                        onclick="obterLocalizacao()">
                                        <i class="fas fa-map-marker-alt"></i> <span id="btnText">Obter
                                            Localização</span>
                                    </button>
                                </div>

                                <div class="col-md-4">
                                    <button type="button" class="btn btn-success btn-block" id="btnMonitorar"
                                        onclick="alternarMonitoramento()">
                                        <i class="fas fa-eye"></i> Iniciar Monitoramento
                                    </button>
                                </div>

                                <div class="col-md-4">
                                    <button type="button" class="btn btn-warning btn-block" onclick="limparCampos()">
                                        <i class="fas fa-trash"></i> Limpar Campos
                                    </button>
                                </div>
                            </div>
                        </form>

                        <!-- Resultado e status -->
                        <div id="resultado" class="mt-4" style="display: none;">
                            <div class="alert alert-success">
                                <h5><i class="fas fa-check-circle"></i> Localização Obtida!</h5>
                                <div id="detalhesLocalizacao"></div>
                            </div>
                        </div>

                        <!-- Código de exemplo -->
                        <div class="code-section mt-4">
                            <h5><i class="fas fa-code"></i> Código de Exemplo</h5>
                            <pre><code>// HTML com classes AutoComplete
&lt;input type="text" class="form-control autocomplete latitude" /&gt;
&lt;input type="text" class="form-control autocomplete longitude" /&gt;

// ou versões abreviadas:
&lt;input type="text" class="form-control autocomplete lat" /&gt;
&lt;input type="text" class="form-control autocomplete long" /&gt;

// HTML com Máscaras e Validações
&lt;input type="text" class="form-control mask latitude obg onkeyup" /&gt;
&lt;input type="text" class="form-control mask longitude precision 6 obg" /&gt;

// JavaScript - os campos são preenchidos automaticamente
$.innerForm.getLocation().then(function(location) {
    // Campos .autocomplete.latitude e .autocomplete.longitude
    // são automaticamente preenchidos!
    console.log('Localização:', location);
});</code></pre>
                        </div>

                        <!-- Tabela de Classes -->
                        <div class="mt-4">
                            <h5><i class="fas fa-table"></i> Resumo das Classes</h5>
                            <div class="table-responsive">
                                <table class="table table-striped table-sm">
                                    <thead class="thead-dark">
                                        <tr>
                                            <th>Funcionalidade</th>
                                            <th>Classe Principal</th>
                                            <th>Classes Alternativas</th>
                                            <th>Exemplo</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><strong>AutoComplete</strong></td>
                                            <td><code>.autocomplete.latitude</code></td>
                                            <td><code>.autocomplete.lat</code></td>
                                            <td>Preenchimento automático</td>
                                        </tr>
                                        <tr>
                                            <td><strong>AutoComplete</strong></td>
                                            <td><code>.autocomplete.longitude</code></td>
                                            <td><code>.autocomplete.long</code></td>
                                            <td>Preenchimento automático</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Máscara</strong></td>
                                            <td><code>.mask.latitude</code></td>
                                            <td><code>.mask.lat</code></td>
                                            <td>Formatação e limites -90/+90</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Máscara</strong></td>
                                            <td><code>.mask.longitude</code></td>
                                            <td><code>.mask.long .mask.lng</code></td>
                                            <td>Formatação e limites -180/+180</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Validação</strong></td>
                                            <td><code>.latitude</code></td>
                                            <td><code>.lat</code></td>
                                            <td>Valida se é latitude válida</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Validação</strong></td>
                                            <td><code>.longitude</code></td>
                                            <td><code>.long .lng</code></td>
                                            <td>Valida se é longitude válida</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Validação</strong></td>
                                            <td><code>.coordinate</code></td>
                                            <td><code>.coordinates .coord</code></td>
                                            <td>Valida par lat,lng</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Precisão</strong></td>
                                            <td><code>.precision 6</code></td>
                                            <td>-</td>
                                            <td>Limita casas decimais</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery e InnerFormValidation -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="InnerFormValidation.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let watchId = null;
        let monitorando = false;

        function obterLocalizacao() {
            const btn = document.getElementById('btnText');
            const btnElement = btn.parentElement;

            // Mostra loading
            btn.innerHTML = '<span class="loading"></span> Obtendo...';
            btnElement.disabled = true;

            $.innerForm.getLocation()
                .then(function (location) {
                    mostrarResultado(location);
                    btn.innerHTML = '<i class="fas fa-map-marker-alt"></i> Obter Localização';
                    btnElement.disabled = false;
                })
                .catch(function (error) {
                    mostrarErro(error);
                    btn.innerHTML = '<i class="fas fa-map-marker-alt"></i> Tentar Novamente';
                    btnElement.disabled = false;
                });
        }

        function alternarMonitoramento() {
            const btn = document.getElementById('btnMonitorar');

            if (!monitorando) {
                // Iniciar monitoramento
                watchId = $.innerForm.watchLocation(
                    function (location) {
                        mostrarResultado(location, true);
                    },
                    function (error) {
                        mostrarErro(error);
                        pararMonitoramento();
                    }
                );

                if (watchId !== null) {
                    monitorando = true;
                    btn.innerHTML = '<i class="fas fa-eye-slash"></i> Parar Monitoramento';
                    btn.className = 'btn btn-danger btn-block';
                }
            } else {
                pararMonitoramento();
            }
        }

        function pararMonitoramento() {
            if (watchId !== null) {
                $.innerForm.clearLocationWatch(watchId);
                watchId = null;
            }

            monitorando = false;
            const btn = document.getElementById('btnMonitorar');
            btn.innerHTML = '<i class="fas fa-eye"></i> Iniciar Monitoramento';
            btn.className = 'btn btn-success btn-block';
        }

        function limparCampos() {
            // Limpa todos os campos autocomplete
            $('.autocomplete.latitude, .autocomplete.lat').val('').text('Aguardando localização...');
            $('.autocomplete.longitude, .autocomplete.long').val('').text('Aguardando localização...');

            // Esconde resultado
            $('#resultado').hide();

            // Para monitoramento se ativo
            if (monitorando) {
                pararMonitoramento();
            }
        }

        function mostrarResultado(location, isMonitoring = false) {
            const resultado = document.getElementById('resultado');
            const detalhes = document.getElementById('detalhesLocalizacao');

            const prefix = isMonitoring ? '🔄 Monitoramento: ' : '📍 ';

            detalhes.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <strong>Coordenadas:</strong><br>
                        Latitude: ${location.latitude.toFixed(6)}<br>
                        Longitude: ${location.longitude.toFixed(6)}
                    </div>
                    <div class="col-md-6">
                        <strong>Precisão:</strong> ${location.accuracyFormatted}<br>
                        <strong>Horário:</strong> ${location.formattedTime}
                    </div>
                </div>
                <div class="mt-2">
                    <a href="${location.googleMapsUrl}" target="_blank" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-map"></i> Ver no Google Maps
                    </a>
                    <a href="${location.osmUrl}" target="_blank" class="btn btn-sm btn-outline-secondary ml-2">
                        <i class="fas fa-globe"></i> Ver no OpenStreetMap
                    </a>
                </div>
            `;

            resultado.style.display = 'block';

            // Se estiver monitorando, muda a cor do alerta
            if (isMonitoring) {
                resultado.querySelector('.alert').className = 'alert alert-warning';
            } else {
                resultado.querySelector('.alert').className = 'alert alert-success';
            }
        }

        function mostrarErro(error) {
            const resultado = document.getElementById('resultado');
            const detalhes = document.getElementById('detalhesLocalizacao');

            detalhes.innerHTML = `
                <div class="text-danger">
                    <strong>Erro:</strong> ${error.userMessage || error.message}<br>
                    <strong>Código:</strong> ${error.error || error.code}
                </div>
                <div class="mt-2">
                    <small class="text-muted">
                        Verifique se você deu permissão para acessar sua localização e se está usando HTTPS.
                    </small>
                </div>
            `;

            resultado.style.display = 'block';
            resultado.querySelector('.alert').className = 'alert alert-danger';
            resultado.querySelector('h5 i').className = 'fas fa-exclamation-triangle';
            resultado.querySelector('h5').innerHTML = '<i class="fas fa-exclamation-triangle"></i> Erro ao Obter Localização';
        }

        // Inicialização
        $(document).ready(function () {
            console.log('AutoComplete de Geolocalização carregado!');
            console.log('Classes disponíveis: .autocomplete.latitude, .autocomplete.longitude, .autocomplete.lat, .autocomplete.long');
        });
    </script>
</body>

</html>