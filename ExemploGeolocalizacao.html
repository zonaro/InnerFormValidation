<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>InnerFormValidation - Exemplo de Geolocaliza√ß√£o</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

    <!-- InnerFormValidation Library -->
    <script src="InnerFormValidation.js"></script>

    <script>
        // Ativar logs para debug
        $.innerForm = {
            verbose: true
        };
    </script>

    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin: 20px 0;
        }

        .btn-custom {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
            color: white;
        }

        .result-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Cabe√ßalho -->
        <div class="text-center mb-4">
            <h1 class="text-white">
                üìç Exemplo de Geolocaliza√ß√£o
            </h1>
            <p class="text-white-50">Demonstra√ß√£o das fun√ß√µes $.innerForm.getLocation()</p>
        </div>

        <!-- Card Principal -->
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">üåç Teste de Geolocaliza√ß√£o</h4>
            </div>
            <div class="card-body">
                <!-- Bot√µes de A√ß√£o -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <button class="btn btn-custom btn-block" onclick="obterLocalizacao()">
                            üìç Obter Localiza√ß√£o Atual
                        </button>
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-success btn-block" id="monitorBtn" onclick="alternarMonitoramento()">
                            üëÅÔ∏è Iniciar Monitoramento
                        </button>
                    </div>
                </div>

                <!-- √Årea de Resultado -->
                <div id="resultado" class="result-box">
                    <p class="text-muted text-center mb-0">
                        Clique em "Obter Localiza√ß√£o Atual" para come√ßar
                    </p>
                </div>

                <!-- Formul√°rio de Exemplo -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Latitude:</label>
                            <input type="text" id="latitude" class="form-control" placeholder="Latitude aparecer√° aqui"
                                readonly>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Longitude:</label>
                            <input type="text" id="longitude" class="form-control"
                                placeholder="Longitude aparecer√° aqui" readonly>
                        </div>
                    </div>
                </div>

                <!-- C√≥digo de Exemplo -->
                <div class="mt-4">
                    <h5>üìù C√≥digo de Exemplo:</h5>
                    <pre class="bg-dark text-light p-3 rounded"><code>// Obter localiza√ß√£o √∫nica
$.innerForm.getLocation()
    .then(function(localizacao) {
        console.log('Latitude:', localizacao.latitude);
        console.log('Longitude:', localizacao.longitude);
        console.log('Precis√£o:', localizacao.accuracyFormatted);
        
        // Preencher campos do formul√°rio
        $('#latitude').val(localizacao.latitude);
        $('#longitude').val(localizacao.longitude);
    })
    .catch(function(erro) {
        console.error('Erro:', erro.userMessage);
        alert('Erro: ' + erro.userMessage);
    });

// Monitorar localiza√ß√£o continuamente
var watchId = $.innerForm.watchLocation(
    function(localizacao) {
        // Callback de sucesso - chamado a cada atualiza√ß√£o
        console.log('Nova posi√ß√£o:', localizacao.coordinates);
    },
    function(erro) {
        // Callback de erro
        console.error('Erro no monitoramento:', erro.userMessage);
    },
    {
        enableHighAccuracy: true,  // Alta precis√£o
        timeout: 10000,           // Timeout de 10 segundos
        maximumAge: 5000          // Cache de 5 segundos
    }
);

// Parar o monitoramento
$.innerForm.clearLocationWatch(watchId);</code></pre>
                </div>
            </div>
        </div>

        <!-- Informa√ß√µes Adicionais -->
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">‚ÑπÔ∏è Informa√ß√µes Importantes</h5>
            </div>
            <div class="card-body">
                <ul class="mb-0">
                    <li><strong>Permiss√£o necess√°ria:</strong> O navegador solicitar√° permiss√£o para acessar sua
                        localiza√ß√£o</li>
                    <li><strong>HTTPS obrigat√≥rio:</strong> A geolocaliza√ß√£o s√≥ funciona em sites com HTTPS (ou
                        localhost)</li>
                    <li><strong>Precis√£o:</strong> A precis√£o varia dependendo do dispositivo e m√©todo (GPS, WiFi,
                        Celular)</li>
                    <li><strong>Timeout:</strong> Por padr√£o, a fun√ß√£o aguarda at√© 10 segundos pela localiza√ß√£o</li>
                    <li><strong>Cache:</strong> Utiliza cache de 60 segundos para melhor performance</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let watchId = null;
        let estaMonitorando = false;

        // Fun√ß√£o para obter localiza√ß√£o √∫nica
        function obterLocalizacao() {
            // Verificar se a fun√ß√£o est√° dispon√≠vel
            if (!$.innerForm || !$.innerForm.getLocation) {
                alert('Erro: A fun√ß√£o $.innerForm.getLocation() n√£o est√° dispon√≠vel. Verifique se o InnerFormValidation.js foi carregado.');
                return;
            }

            // Mostrar loading
            document.getElementById('resultado').innerHTML = `
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="sr-only">Carregando...</span>
                    </div>
                    <p class="mt-2 mb-0">Obtendo sua localiza√ß√£o...</p>
                    <small class="text-muted">Permita o acesso quando solicitado pelo navegador</small>
                </div>
            `;

            // Obter localiza√ß√£o com configura√ß√µes customizadas
            $.innerForm.getLocation({
                enableHighAccuracy: true,
                timeout: 15000,
                maximumAge: 60000
            })
                .then(function (localizacao) {
                    // Sucesso - exibir informa√ß√µes
                    mostrarResultado(localizacao);

                    // Preencher campos do formul√°rio
                    document.getElementById('latitude').value = localizacao.latitude;
                    document.getElementById('longitude').value = localizacao.longitude;

                    console.log('Localiza√ß√£o obtida:', localizacao);
                })
                .catch(function (erro) {
                    // Erro - exibir mensagem
                    document.getElementById('resultado').innerHTML = `
                    <div class="alert alert-danger">
                        <h6>‚ùå Erro ao obter localiza√ß√£o</h6>
                        <p class="mb-0">${erro.userMessage || erro.message}</p>
                    </div>
                `;

                    console.error('Erro de geolocaliza√ß√£o:', erro);
                });
        }

        // Fun√ß√£o para alternar monitoramento
        function alternarMonitoramento() {
            if (!estaMonitorando) {
                iniciarMonitoramento();
            } else {
                pararMonitoramento();
            }
        }

        // Fun√ß√£o para iniciar monitoramento
        function iniciarMonitoramento() {
            if (!$.innerForm || !$.innerForm.watchLocation) {
                alert('Erro: A fun√ß√£o de monitoramento n√£o est√° dispon√≠vel.');
                return;
            }

            watchId = $.innerForm.watchLocation(
                function (localizacao) {
                    // Callback de sucesso
                    mostrarResultado(localizacao, true);

                    // Atualizar campos
                    document.getElementById('latitude').value = localizacao.latitude;
                    document.getElementById('longitude').value = localizacao.longitude;
                },
                function (erro) {
                    // Callback de erro
                    document.getElementById('resultado').innerHTML = `
                        <div class="alert alert-danger">
                            <h6>‚ùå Erro no monitoramento</h6>
                            <p class="mb-0">${erro.userMessage || erro.message}</p>
                        </div>
                    `;
                    pararMonitoramento();
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 5000
                }
            );

            if (watchId !== null) {
                estaMonitorando = true;
                document.getElementById('monitorBtn').textContent = '‚èπÔ∏è Parar Monitoramento';
                document.getElementById('monitorBtn').className = 'btn btn-danger btn-block';
            }
        }

        // Fun√ß√£o para parar monitoramento
        function pararMonitoramento() {
            if (watchId !== null && $.innerForm && $.innerForm.clearLocationWatch) {
                $.innerForm.clearLocationWatch(watchId);
                watchId = null;
            }

            estaMonitorando = false;
            document.getElementById('monitorBtn').textContent = 'üëÅÔ∏è Iniciar Monitoramento';
            document.getElementById('monitorBtn').className = 'btn btn-success btn-block';
        }

        // Fun√ß√£o para mostrar resultado
        function mostrarResultado(localizacao, monitorando = false) {
            const badge = monitorando ? '<span class="badge badge-success">Monitorando</span>' : '<span class="badge badge-info">Obtido</span>';

            document.getElementById('resultado').innerHTML = `
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <h6>üìç Sua Localiza√ß√£o ${badge}</h6>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Latitude:</strong> ${localizacao.latitude}</p>
                        <p><strong>Longitude:</strong> ${localizacao.longitude}</p>
                        <p><strong>Coordenadas:</strong> ${localizacao.coordinates}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Precis√£o:</strong> ${localizacao.accuracyFormatted}</p>
                        <p><strong>Obtido em:</strong> ${localizacao.formattedTime}</p>
                        ${localizacao.altitude ? `<p><strong>Altitude:</strong> ${localizacao.altitude}m</p>` : ''}
                    </div>
                    <div class="col-md-12 mt-2">
                        <a href="${localizacao.googleMapsUrl}" target="_blank" class="btn btn-outline-primary btn-sm mr-2">
                            üó∫Ô∏è Google Maps
                        </a>
                        <a href="${localizacao.osmUrl}" target="_blank" class="btn btn-outline-info btn-sm">
                            üåç OpenStreetMap
                        </a>
                    </div>
                </div>
            `;
        }

        // Parar monitoramento ao sair da p√°gina
        window.addEventListener('beforeunload', function () {
            if (estaMonitorando) {
                pararMonitoramento();
            }
        });
    </script>
</body>

</html>